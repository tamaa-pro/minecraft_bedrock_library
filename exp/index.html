<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>موقع تجربة الكود</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
<style>
body{background:#808080;margin:0;padding:10px;font-family:Arial;height:100vh;box-sizing:border-box;overflow:hidden;display:flex;flex-direction:column}
.container{display:flex;flex-direction:column;height:100%;gap:10px}
.code-container{height:60vh;background:#000;border:2px solid #333;border-radius:5px;overflow:hidden;display:flex;flex-direction:column}
.controls{display:flex;gap:8px;padding:8px;background:#555}
.controls button{padding:8px 12px;min-width:36px;font-size:16px;transition:transform .1s}
.controls button:active{transform:scale(1.05)}
#codeArea{flex:1;padding:12px;background:#000;color:#fff;font-family:'Fira Code',monospace;font-size:14px;line-height:1.5;border:none;resize:none;white-space:pre;direction:ltr;text-align:left;overflow:auto;tab-size:4}
.options-container{background:#555;border-radius:5px;padding:12px;display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center}
.option-group{display:flex;gap:8px;align-items:center}
button,input{padding:10px 14px;border:none;border-radius:6px;background:#444;color:#fff;cursor:pointer;white-space:nowrap;font-size:14px;transition:all .2s}
button:hover{background:#666}
#runBtn{background:#4CAF50}
#runBtn:hover{filter:brightness(1.1)}
.notification{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#222;color:#fff;padding:12px 18px;border-radius:6px;z-index:1000;display:none;animation:fadeIn .3s;box-shadow:0 4px 12px rgba(0,0,0,.15);max-width:80%}
.notification.error{background:#d32f2f}
@keyframes fadeIn{from{opacity:0;transform:translate(-50%,-10px)}to{opacity:1;transform:translate(-50%,0)}}
.color-option{width:18px;height:18px;display:inline-block;margin-right:8px;vertical-align:middle;border:1px solid #fff;border-radius:3px}
.dropdown{position:relative;display:inline-block}
.dropdown-content{display:none;position:absolute;background:#444;box-shadow:0 8px 16px rgba(0,0,0,.2);z-index:1;border-radius:6px;padding:8px;bottom:100%;left:0;width:max-content;max-width:95vw}
.dropdown.active .dropdown-content{display:block}
.dropdown-content button{width:100%;text-align:left;margin:4px 0;padding:8px 12px;border-radius:4px;white-space:nowrap}
.toggle-switch{display:flex;align-items:center;gap:8px;color:#fff}
.switch{position:relative;display:inline-block;width:34px;height:20px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#ccc;transition:.4s;border-radius:20px}
.slider:before{position:absolute;content:"";height:16px;width:16px;left:2px;bottom:2px;background:#fff;transition:.4s;border-radius:50%}
input:checked+.slider{background:#4CAF50}
input:checked+.slider:before{transform:translateX(14px)}
</style>
</head>
<body>
<div class="container">
<div class="code-container">
<div class="controls">
<button title="تراجع" id="undoBtn"><i class="fas fa-undo"></i></button>
<button title="إعادة" id="redoBtn"><i class="fas fa-redo"></i></button>
<button title="الذهاب إلى البداية" id="goTopBtn"><i class="fas fa-arrow-up"></i></button>
<button title="الذهاب إلى النهاية" id="goBottomBtn"><i class="fas fa-arrow-down"></i></button>
<button title="قص" id="cutBtn"><i class="fas fa-cut"></i></button>
<button title="نسخ" id="copyBtn"><i class="far fa-copy"></i></button>
<button title="لصق" id="pasteBtn"><i class="fas fa-paste"></i></button>
<button title="حذف" id="deleteBtn"><i class="far fa-trash-alt"></i></button>
</div>
<textarea id="codeArea" spellcheck="false"></textarea>
</div>
<div class="options-container">
<div class="option-group dropdown" id="colorDropdown">
<button id="colorBtn"><i class="fas fa-palette"></i> لون النص</button>
<div class="dropdown-content">
<button data-color="#ffffff" data-bg="#000000"><span class="color-option" style="background:#fff"></span>أبيض</button>
<button data-color="#000000" data-bg="#ffffff"><span class="color-option" style="background:#000"></span>أسود</button>
<button data-color="#808080" data-bg="#000000"><span class="color-option" style="background:#808080"></span>رمادي</button>
<button data-color="#90EE90" data-bg="#000000"><span class="color-option" style="background:#90EE90"></span>أخضر فاتح</button>
<button data-color="#9370DB" data-bg="#000000"><span class="color-option" style="background:#9370DB"></span>بنفسجي</button>
<button data-color="#FFD700" data-bg="#000000"><span class="color-option" style="background:#FFD700"></span>أصفر</button>
<button data-color="#FFA500" data-bg="#000000"><span class="color-option" style="background:#FFA500"></span>برتقالي</button>
</div>
</div>
<div class="option-group dropdown" id="compressDropdown">
<button id="compressBtn"><i class="fas fa-compress-alt"></i> ضغط الكود</button>
<div class="dropdown-content">
<button id="removeSpacesBtn"><i class="fas fa-minus"></i> حذف الفراغات فقط</button>
<button id="removeLineBreaksBtn"><i class="fas fa-arrow-down"></i> حذف النزول للسطر فقط</button>
<button id="compressAllBtn"><i class="fas fa-file-archive"></i> ضغط كامل</button>
</div>
</div>
<div class="option-group toggle-switch">
<label for="wrapToggle"><i class="fas fa-text-width"></i> السطر التلقائي:</label>
<label class="switch">
<input type="checkbox" id="wrapToggle" checked>
<span class="slider"></span>
</label>
</div>
<div class="option-group">
<input type="file" id="fileImport" accept=".html,.htm,.txt,.js,.css,.php" style="display:none">
<button id="importFileBtn"><i class="fas fa-file-import"></i> استيراد من ملف</button>
</div>
<div class="option-group">
<input type="text" id="urlInput" placeholder="رابط الكود">
<button id="importUrlBtn"><i class="fas fa-link"></i> استيراد من رابط</button>
</div>
<button id="exportFileBtn"><i class="fas fa-file-export"></i> حفظ كملف</button>
<button id="runBtn"><i class="fas fa-play"></i> تشغيل الكود</button>
</div>
</div>
<div class="notification" id="notification"></div>
<script>
// عناصر DOM
const codeArea = document.getElementById('codeArea');
const colorBtn = document.getElementById('colorBtn');
const colorDropdown = document.getElementById('colorDropdown');
const compressBtn = document.getElementById('compressBtn');
const compressDropdown = document.getElementById('compressDropdown');
const removeSpacesBtn = document.getElementById('removeSpacesBtn');
const removeLineBreaksBtn = document.getElementById('removeLineBreaksBtn');
const compressAllBtn = document.getElementById('compressAllBtn');
const wrapToggle = document.getElementById('wrapToggle');
const fileImport = document.getElementById('fileImport');
const importFileBtn = document.getElementById('importFileBtn');
const urlInput = document.getElementById('urlInput');
const importUrlBtn = document.getElementById('importUrlBtn');
const exportFileBtn = document.getElementById('exportFileBtn');
const runBtn = document.getElementById('runBtn');
const undoBtn = document.getElementById('undoBtn');
const redoBtn = document.getElementById('redoBtn');
const goTopBtn = document.getElementById('goTopBtn');
const goBottomBtn = document.getElementById('goBottomBtn');
const cutBtn = document.getElementById('cutBtn');
const copyBtn = document.getElementById('copyBtn');
const pasteBtn = document.getElementById('pasteBtn');
const deleteBtn = document.getElementById('deleteBtn');
const notification = document.getElementById('notification');

// تاريخ التعديلات للتراجع والإعادة
let history = [''];
let historyIndex = 0;

// تهيئة المحرر
initEditor();

function initEditor() {
    // استعادة الألوان المحفوظة
    const savedColor = localStorage.getItem('textColor') || '#ffffff';
    const savedBg = localStorage.getItem('textBg') || '#000000';
    applyColors(savedColor, savedBg);
    
    // استعادة وضع السطر التلقائي
    const savedWrap = localStorage.getItem('wrapMode') !== 'false';
    wrapToggle.checked = savedWrap;
    updateWrapMode(savedWrap);
    
    // استعادة المحتوى المحفوظ
    const savedCode = localStorage.getItem('savedCode');
    if (savedCode) {
        codeArea.value = savedCode;
        history = [savedCode];
    }
    
    // إعداد مستمعات الأحداث
    setupEventListeners();
}

function setupEventListeners() {
    // التحكم في النص
    undoBtn.addEventListener('click', undo);
    redoBtn.addEventListener('click', redo);
    goTopBtn.addEventListener('click', () => {
        codeArea.selectionStart = codeArea.selectionEnd = 0;
        codeArea.focus();
        showNotification('تم الانتقال إلى بداية الكود');
    });
    goBottomBtn.addEventListener('click', () => {
        codeArea.selectionStart = codeArea.selectionEnd = codeArea.value.length;
        codeArea.focus();
        showNotification('تم الانتقال إلى نهاية الكود');
    });
    cutBtn.addEventListener('click', () => document.execCommand('cut'));
    copyBtn.addEventListener('click', copyText);
    pasteBtn.addEventListener('click', handlePaste);
    deleteBtn.addEventListener('click', handleDelete);
    
    // تغيير اللون
    document.querySelectorAll('[data-color]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const color = e.target.getAttribute('data-color');
            const bg = e.target.getAttribute('data-bg');
            applyColors(color, bg);
            colorDropdown.classList.remove('active');
        });
    });
    
    // ضغط الكود
    removeSpacesBtn.addEventListener('click', () => {
        compressCode('spaces');
        compressDropdown.classList.remove('active');
    });
    removeLineBreaksBtn.addEventListener('click', () => {
        compressCode('lineBreaks');
        compressDropdown.classList.remove('active');
    });
    compressAllBtn.addEventListener('click', () => {
        compressCode('all');
        compressDropdown.classList.remove('active');
    });
    
    // تبديل وضع السطر التلقائي
    wrapToggle.addEventListener('change', () => {
        const enabled = wrapToggle.checked;
        updateWrapMode(enabled);
        localStorage.setItem('wrapMode', enabled);
    });
    
    // استيراد من ملف
    importFileBtn.addEventListener('click', () => fileImport.click());
    
    fileImport.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
            codeArea.value = event.target.result;
            saveToHistory();
            saveCode();
            showNotification('تم تحميل الملف بنجاح');
        };
        reader.readAsText(file);
    });
    
    // استيراد من رابط
    importUrlBtn.addEventListener('click', async () => {
        const url = urlInput.value.trim();
        if (!url) return;
        
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('فشل جلب الملف');
            const text = await response.text();
            codeArea.value = text;
            saveToHistory();
            saveCode();
            showNotification('تم تحميل الرابط بنجاح');
        } catch (error) {
            showNotification('حدث خطأ أثناء جلب الملف: ' + error.message, true);
        }
    });
    
    // تصدير إلى ملف
    exportFileBtn.addEventListener('click', () => {
        const blob = new Blob([codeArea.value], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'index.html';
        a.click();
        URL.revokeObjectURL(url);
        showNotification('تم تحميل الملف بنجاح');
    });
    
    // تشغيل الكود في صفحة جديدة
    runBtn.addEventListener('click', () => {
        const code = codeArea.value;
        const blob = new Blob([`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>معاينة الكود</title></head><body>${code}</body></html>`], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const newWindow = window.open('about:blank', '_blank');
        newWindow.location.href = url;
        showNotification('تم تشغيل الكود في نافذة جديدة');
    });
    
    // حفظ التاريخ عند التعديل
    codeArea.addEventListener('input', () => {
        saveToHistory();
        saveCode();
    });
    
    // إدارة القوائم المنسدلة
    colorBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        colorDropdown.classList.toggle('active');
        compressDropdown.classList.remove('active');
    });
    
    compressBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        compressDropdown.classList.toggle('active');
        colorDropdown.classList.remove('active');
    });
    
    document.addEventListener('click', () => {
        colorDropdown.classList.remove('active');
        compressDropdown.classList.remove('active');
    });
}

// تطبيق الألوان
function applyColors(color, bg) {
    codeArea.style.color = color;
    codeArea.style.backgroundColor = bg;
    localStorage.setItem('textColor', color);
    localStorage.setItem('textBg', bg);
    showNotification('تم تغيير لون النص');
}

// ضغط الكود
function compressCode(mode) {
    let compressed = codeArea.value;
    
    switch(mode) {
        case 'spaces':
            compressed = compressed.replace(/\s+/g, ' ').trim();
            showNotification('تم حذف الفراغات الزائدة');
            break;
        case 'lineBreaks':
            compressed = compressed.replace(/\n+/g, '');
            showNotification('تم حذف النزول للسطر');
            break;
        case 'all':
            compressed = compressed.replace(/\s+/g, '');
            showNotification('تم ضغط الكود بالكامل');
            break;
    }
    
    codeArea.value = compressed;
    saveToHistory();
    saveCode();
}

// تحديث وضع السطر التلقائي
function updateWrapMode(enabled) {
    if (enabled) {
        codeArea.style.whiteSpace = 'pre-wrap';
        codeArea.style.overflowX = 'hidden';
        codeArea.style.wordWrap = 'break-word';
    } else {
        codeArea.style.whiteSpace = 'pre';
        codeArea.style.overflowX = 'auto';
        codeArea.style.wordWrap = 'normal';
    }
}

// معالجة اللصق
function handlePaste() {
    navigator.clipboard.readText().then(text => {
        const startPos = codeArea.selectionStart;
        const endPos = codeArea.selectionEnd;
        const currentText = codeArea.value;
        
        codeArea.value = currentText.substring(0, startPos) + text + currentText.substring(endPos);
        
        // تحديث موضع المؤشر
        codeArea.selectionStart = codeArea.selectionEnd = startPos + text.length;
        
        saveToHistory();
        saveCode();
        showNotification('تم لصق النص');
    }).catch(() => {
        document.execCommand('paste');
    });
}

// معالجة الحذف
function handleDelete() {
    if (codeArea.selectionStart === codeArea.selectionEnd) {
        // إذا لم يكن هناك نص محدد، احذف كل شيء
        codeArea.value = '';
        showNotification('تم حذف كل النص');
    } else {
        // إذا كان هناك نص محدد، احذفه فقط
        document.execCommand('delete');
        showNotification('تم حذف النص المحدد');
    }
    
    saveToHistory();
    saveCode();
}

// وظائف التحكم في التاريخ
function undo() {
    if (historyIndex > 0) {
        historyIndex--;
        codeArea.value = history[historyIndex];
        showNotification('تم التراجع');
    }
}

function redo() {
    if (historyIndex < history.length - 1) {
        historyIndex++;
        codeArea.value = history[historyIndex];
        showNotification('تم الإعادة');
    }
}

function copyText() {
    codeArea.select();
    document.execCommand('copy');
    showNotification('تم نسخ النص');
}

function saveToHistory() {
    if (codeArea.value === history[historyIndex]) return;
    
    history = history.slice(0, historyIndex + 1);
    history.push(codeArea.value);
    historyIndex = history.length - 1;
    
    // الحد الأقصى لتاريخ التعديلات
    if (history.length > 50) {
        history.shift();
        historyIndex--;
    }
}

function saveCode() {
    localStorage.setItem('savedCode', codeArea.value);
}

// عرض الإشعارات
function showNotification(message, isError = false) {
    const notificationElement = notification;
    notificationElement.innerHTML = (isError ? '<i class="fas fa-exclamation-circle"></i> ' : '') + message;
    notificationElement.className = 'notification' + (isError ? ' error' : '');
    notificationElement.style.display = 'block';
    
    setTimeout(() => {
        notificationElement.style.display = 'none';
    }, 2000);
}
</script>
</body>
</html>
