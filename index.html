<!DOCTYPE html>
<html lang="ar" dir="rtl">
<script>
(function(){let m=navigator.userAgent;if(!localStorage.getItem("trusted"))setTimeout(()=>localStorage.setItem("trusted","yes"),3000);if(!/Android|iPhone|iPad|iPod|Mobile/i.test(m)&&!localStorage.getItem("trusted")){window.open("about:blank","_self");}})();
</script>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مكتبة ماين كرافت بيدروك</title>
<meta name="description" content="تطبيق المكتبة يوفر سجل لجميع إصدارات ماين كرافت البيدروك (الجوال) . روابط مباشرة ، مع اضافات متنوعة .">
<meta name="keywords" content="مايني كرافت, Minecraft , مكتبة ماين كرافت, تحميل مايني كرافت آخر إصدار , تحميل ماين كرافت, إصدارات ماين كرافت, تطبيق المكتبة , مكتبة ماين كرافت بيدروك , مكتبة ماين كرافت , المكتبة , ماين كرافت , مايني كرافت , تحميل مايني كرافت آخر إصدار للجوال , رابط تحميل مايني كرافت , TAMAA PRO , تحميل تطبيق المكتبة , تطبيق مكتبة ماين كرافت بيدروك , تحميل مايني كرافت الجوال,">
<meta name="google-site-verification" content="8Qxv5unoTh0CgGnKKBA_EpUnSAyP7PignahKPTm7Eao" />
<link rel="icon" href="https://k.top4top.io/p_3439brqf60.png" type="image/png">
<script>
!function(){const e=new Date('2026-01-01T00:00:00+01:00');function t(){fetch('https://worldtimeapi.org/api/timezone/Africa/Casablanca').then(t=>t.json()).then(t=>{new Date(t.datetime)>=e&&(window.location.replace('about:blank'),document.body.innerHTML='')}).catch(()=>{new Date>=e&&window.location.replace('about:blank')})}setInterval(t,1e3),window.onload=t}();
</script>
<script>
(function(){
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  if (/FBAN|FBAV|FB_IAB|Instagram|Messenger/i.test(ua)) {
    const url = window.location.href;
    window.location.href = "intent://" + url.replace(/^https?:\/\//, '') + "#Intent;scheme=https;package=com.android.chrome;end";
    setTimeout(() => {
      window.open(url, "_system") || window.open(url, "_blank");
    }, 1000);
  }
})();
</script>
<style>
html, body {margin: 0;padding: 0;background-color: #444444;color: white;font-family: sans-serif;overflow-y: auto;}
.container {max-width: 800px;margin: 40px auto;padding: 20px;background-color: #444444;border-radius: 15px;box-shadow: 0 0 10px #000;}
a, h2, p, span {color: white;text-decoration: none;}
</style>
</head>
<body>
<script>
if ('serviceWorker' in navigator) {navigator.serviceWorker.getRegistrations().then(function(registrations) {for(let registration of registrations) {registration.unregister();}});}
window.addEventListener('pageshow', function (event) {if (event.persisted) {window.location.reload();}});
</script>
<script>
document.addEventListener('wheel', function(e) {if (e.ctrlKey) e.preventDefault();}, { passive: false });document.addEventListener('keydown', function(e) {if ((e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '=')) || e.key === 'Meta') {e.preventDefault();}});document.addEventListener('contextmenu', e => e.preventDefault());document.addEventListener('selectstart', function(e) {e.preventDefault();});document.addEventListener('copy', function(e) {e.preventDefault();});
document.addEventListener('keydown', function(e) {if ((e.ctrlKey || e.metaKey) && 
(e.key === '+' || e.key === '-' || e.key === '0' || e.keyCode === 187 || e.keyCode === 189 || e.keyCode === 48)) {e.preventDefault();}});document.addEventListener('wheel', function(e) {if (e.ctrlKey) {e.preventDefault();}}, { passive: false });let lastTouchEnd = 0;document.addEventListener('touchstart', function(e) {if (e.touches.length > 1) {e.preventDefault();}});document.addEventListener('touchend', function(e) {const now = Date.now();if (now - lastTouchEnd <= 300) {e.preventDefault();}
lastTouchEnd = now;}, { passive: false });document.addEventListener('touchmove', function(e) {if (e.touches.length > 1) {e.preventDefault();}}, { passive: false });document.addEventListener('dblclick', function(e) {e.preventDefault();}, { passive: false });const viewportMeta = document.querySelector('meta[name="viewport"]');viewportMeta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
</script>
<script>
if (performance.navigation.type !== 1 && !sessionStorage.getItem("reloaded")) {sessionStorage.setItem("reloaded", "true");
setTimeout(() => {location.reload();}, 1000);} else {sessionStorage.removeItem("reloaded");}
</script>
<script>
if ('serviceWorker' in navigator) {navigator.serviceWorker.getRegistrations().then(function(registrations) {for(let registration of registrations) {registration.unregister();}});}
window.addEventListener('pageshow', function (event) {if (event.persisted) {window.location.reload();}});
</script>
<a href="stats/" style="display: inline-block;background: #222;padding: 3px 5px;border-radius: 5px;margin-top: 5px;margin-left: 5px;text-decoration: none;float: left;" onmousedown="this.querySelector('i').style.color='red'" onmouseup="this.querySelector('i').style.color='#007bff'">
<i class="fas fa-chart-line" style="color: #007bff;font-size: 15px;transition: color 0.3s ease;"></i>
</a>
<div style="background-color: #444444; border-radius: 0px; color: white; font-family: sans-serif; margin: auto; max-width: 700px; padding: 20px;">
<div style="align-items: center; display: flex; gap: 15px; margin-bottom: 20px;">
<div style="background: #000; border-radius: 15px; height: 80px; width: 80px; display: flex; align-items: center; justify-content: center;">
<img alt="أيقونة التطبيق" src="https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/library_icon.png" style="border-radius: 15px; height: 80px; width: 80px; object-fit: cover; display: block;" loading="eager" />
</div>
<div>
<h2 style="margin: 0px;">المكتبة</h2>
<p style="color: #cccccc; font-size: 14px; margin: 3px 0px;">TAMAA PRO STUDIO</p>
</div>
</div>
<div style="background-color: #333333; border-radius: 8px; font-size: 14px; margin-bottom: 15px; overflow-x: auto; padding: 10px; white-space: nowrap;">
<span id="downloads" style="margin-right: 20px;">[ التحميلات: ⌕ ]</span>
<span id="ratings" style="margin-right: 20px;">[ التقييم: 0.0 ]</span>
<span id="size" style="margin-right: 20px;">[ 28MB ]</span>
<span id="version" style="margin-right: 20px;">[ v2.5 ]</span>
<span id="date" style="margin-right: 20px;">[ 2025/07/04 ]</span>
<span id="platform" style="margin-right: 20px;">[ Android ]</span>
<span id="author" style="margin-right: 20px;"></span>
</div>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<div id="tip-toast" style="align-items: center; background: rgb(46, 46, 46); border-radius: 10px; box-shadow: rgb(0, 0, 0) 0px 0px 10px; color: white; display: flex; font-size: 13px; gap: 10px; max-width: 320px; opacity: 0; padding: 10px 15px; position: fixed; right: 20px; top: 20px; transform: translateY(-150%); transition: transform 0.4s, opacity 0.4s; z-index: 9999;"><i class="fa-solid fa-circle-info" id="tip-icon" style="font-size: 16px;"></i><span id="tip-text"></span></div><style>#counter,#tip-size,#tip-version,#tip-date,#tip-platform,#tip-author{cursor:pointer;outline:none;user-select:none}</style><script>const tips={downloads:
["fa-chart-column","عدد مرات الضغط على زر التحميل ."],
"ratings":
["fas fa-star","التقييم العام للتطبيق (من التعليقات) ."],                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
"size":
["fa-box-archive","حجم التطبيق الكامل قبل التثبيت (28.8MB) ."],
"version":
["fa-code-branch","رقم آخر إصدار للتطبيق (2.5) ."],
"date":
["fa-calendar-days",
"تاريخ نشر هذا الإصدار (2025/07/04) ."],
"platform":
["fab fa-android","نظام التشغيل المدعوم: أندرويد فقط ."],
"author":
["fa-user-gear","صاحب التطبيق و أحد أعضاء الأستوديو ."]
};let isShowing=!1,pendingTip=null;for(const id in tips){const el=document.getElementById(id);el&&el.addEventListener("click",e=>{e.stopPropagation(),isShowing?(pendingTip=tips[id],hideTip(!0)):showTip(...tips[id])})}function showTip(e,t){const i=document.getElementById("tip-toast"),n=document.getElementById("tip-icon"),o=document.getElementById("tip-text");n.className=e.includes("fab")?`fab ${e.split(" ")[1]}`:`fa-solid ${e}`,o.textContent=t,i.style.display="flex",requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="translateY(0)",isShowing=!0}),clearTimeout(window.toastTimer),window.toastTimer=setTimeout(()=>hideTip(!1),4e3)}function hideTip(e){const t=document.getElementById("tip-toast");t.style.opacity="0",t.style.transform="translateY(-150%)",isShowing=!1,clearTimeout(window.toastTimer),setTimeout(()=>{t.style.display="none",e&&pendingTip&&(showTip(...pendingTip),pendingTip=null)},400)}document.addEventListener("click",()=>{isShowing&&hideTip(!1)});</script>
<div style="margin: 20px auto; padding: 0px 10px; text-align: center;">
<a href="https://github.com/tamaa-pro/minecraft_bedrock_library/releases/download/v2.5/library.apk" id="downloadBtn" onclick="startDownload(event)" style="background-color: #4caf50; border-radius: 8px; color: white; cursor: pointer; display: inline-block; font-size: 14px; max-width: 450px; padding: 14px 0px; text-decoration: none; width: 100%;">تحميل التطبيق</a>
</div>
<style>#toastUpdate{position:fixed;bottom:-100px;left:50%;transform:translateX(-50%);width:90%;max-width:600px;height:45px;line-height:45px;background:#222;color:#fff;padding:0 15px;border-radius:5px;font-family:sans-serif;font-size:12px;box-shadow:0 0 10px #000;z-index:9999;white-space:nowrap;overflow:hidden;text-overflow:clip;text-align:center;transition:bottom 0.6s ease;display:none}</style>
<div id="toastUpdate">يتم تحديث التطبيق و رفعه للموقع في الوقت الحالي، يرجى العودة في وقت لاحق...</div>
<script>let updateInProgress=false;if(updateInProgress){window.addEventListener("DOMContentLoaded",()=>{const b=document.getElementById("downloadBtn"),t=document.getElementById("toastUpdate");if(b){b.disabled=true;b.style.pointerEvents="none";b.style.backgroundColor="#8B0000";b.innerText="في انتظار التحديث..."}t.style.display="block";setTimeout(()=>{t.style.bottom="25px"},100);});}</script>
<style>
@keyframes jump{0%{transform:translateY(0)}100%{transform:translateY(-6px)}}
</style>
<script>
document.getElementById("downloadBtn").addEventListener("click",function(){
  const t=document.getElementById("toastMessage");
  t.style.bottom="30px";
  setTimeout(()=>{t.style.bottom="-100px"},8500);
});
</script>
<script>
const ua = navigator.userAgent.toLowerCase(); if (ua.includes('fbav') || ua.includes('instagram') || ua.includes('telegram')) { const warning = document.createElement('div');
warning.style.backgroundColor = '#ffdddd';
warning.style.color = '#b30000';
warning.style.padding = '10px';
warning.style.borderRadius = '8px';
warning.style.margin = '15px';
warning.style.fontSize = '11px';
warning.style.textAlign = 'center';
warning.innerHTML = 
'⚠︎ المتصفح الذي تستعمله لا يدعم تحميل الملفات بشكل مباشر .<br> يُفضل فتح هذه الصفحة في متصفح خارجي مثل <b>Chrome</b> لتجنب مشاكل التحميل .';
document.body.insertBefore(warning, document.body.firstChild);}
</script>
<script>
function startDownload(event) {const btn = event.currentTarget;btn.innerHTML = '<span style="display:inline-block; width:16px; height:16px; border:2px solid white; border-top:2px solid transparent; border-radius:50%; margin-right:8px; vertical-align:middle; animation: spin 1s linear infinite;"></span> جاري التحميل';btn.removeAttribute('id');btn.removeAttribute('href');btn.removeAttribute('onclick');btn.style.pointerEvents = 'none';btn.style.opacity = '0.7';setTimeout(() => {window.location.href = "https://github.com/tamaa-pro/minecraft_bedrock_library/releases/download/v2.5/library.apk";}, 500);event.preventDefault();}
const style = document.createElement('style');style.textContent = `@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}a:focus {outline: none !important;box-shadow: none !important;}`;document.head.appendChild(style);
</script>
<script>
(function(){const a=document.getElementById("downloads"),b=document.getElementById("downloadBtn"),c="683f23508960c979a5a4d239",d="$2a$10$F5TR7pSKPRRNAeBzsdxQ4.NYog8xHGUi0hektkor0q/QWFVXzba3q";async function e(){try{const f=await fetch(`https://api.jsonbin.io/v3/b/${c}/latest`,{headers:{"X-Master-Key":d}}),g=await f.json(),h=g.record.count||0;a.textContent=`[ التحميلات: ${h} ]`}catch(i){a.textContent="[ التحميلات: غير متوفرة ]",console.error(i)}}async function j(){try{if(sessionStorage.getItem("alreadyDownloaded"))return;const k=await fetch(`https://api.jsonbin.io/v3/b/${c}/latest`,{headers:{"X-Master-Key":d}}),l=await k.json();let m=l.record.count||0;m++;await fetch(`https://api.jsonbin.io/v3/b/${c}`,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":d,"X-Bin-Versioning":"false"},body:JSON.stringify({count:m})});a.textContent=`[ التحميلات: ${m} ]`;sessionStorage.setItem("alreadyDownloaded","true")}catch(n){alert("[ فشل تحديث عدد التحميلات ]"),console.error(n)}}e(),b.addEventListener("click",j)})();
</script>
<txt style="color:#00F500">لقطات من التطبيق :</txt>
<style>
.ss-track{display:flex;gap:10px;overflow-x:auto;margin-top:20px;padding-bottom:5px}
.ss-item{width:91px;height:180px;background:#000;border-radius:10px;position:relative;overflow:hidden;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.ss-item img{max-width:100%;max-height:100%;object-fit:contain;display:none}
.ss-spinner{position:absolute;width:24px;height:24px;border:3px solid #555;border-top:3px solid lime;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
<div class="ss-track" id="ssContainer"></div>
<script>
const images=[
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/tamaa_pro.png",
 "شعار الأستوديو"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/log_in.png",
 "تسجيل الدخول"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/home.png",
 "الصفحة الرئيسية"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/side_menu.png",
 "القائمة الجانبية"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/last_version.png",
 "آخر إصدار"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/download_page.png",
 "صفحة التحميل"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/basic_versions.png",
 "الإصدارات الأساسية"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/1.21_1.19.png",
 "إصدارات 21-20-19"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/1.18_1.16.png",
 "إصدارات 18-17-16"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/1.14_1.0.png",
 "إصدارات أقدم من 1.16"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/patch.png",
 "باتش"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/commands.png",
 "أوامر ماين كرافت"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/suggested_programs.png",
 "برامج مقترحة"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/suggested_sites.png",
 "مواقع مقترحة"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/library_community.png",
 "دردشة المجتمع"],
["https://tamaa-pro.github.io/minecraft_bedrock_library/data/screenshots/youtube_channels.png",
"قنوات ماين كرافت"]
];const container=document.getElementById("ssContainer");const elements=[];images.forEach(([src,alt])=>{const wrap=document.createElement("div");wrap.className="ss-item";const spinner=document.createElement("div");spinner.className="ss-spinner";const img=document.createElement("img");img.alt=alt;img.src=src;
img.style.display="none";wrap.appendChild(spinner);wrap.appendChild(img);container.appendChild(wrap);elements.push({img,spinner,src});img.onload=()=>{img.style.display="block";spinner.remove();};img.onerror=()=>{const errorWrapper=document.createElement("div");errorWrapper.style.position="absolute";errorWrapper.style.display="flex";errorWrapper.style.flexDirection="column";errorWrapper.style.alignItems="center";errorWrapper.style.justifyContent="center";errorWrapper.style.width="100%";errorWrapper.style.height="100%";const errorIcon=document.createElement("div");errorIcon.innerHTML=`<svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" stroke="#FF0000" stroke-width="2"/><path d="M12 8V12" stroke="#FF0000" stroke-width="2" stroke-linecap="round"/><path d="M12 16H12.01" stroke="#FF0000" stroke-width="2" stroke-linecap="round"/></svg>`;const errorText=document.createElement("span");errorText.textContent="فشل التحميل";errorText.style.color="#FF0000";errorText.style.fontSize="12px";errorText.style.marginTop="5px";errorWrapper.appendChild(errorIcon);errorWrapper.appendChild(errorText);spinner.remove();img.parentNode.appendChild(errorWrapper);};});
</script>
<br /><hr />
<p style="line-height: 1.6;">
  ✦ تطبيق المكتبة يوفر سجلًا بكل إصدارات ماين كرافت البيدروك مع إمكانية تحميلها بسهولة وأمان . كما يتيح تحميل آخر إصدار (رسمي و بيتا) في الوقت الفعلي ، سواء نسخة مخففة أو الكاملة للهواتف الضعيفة والقوية ، و كذلك أقسام متنوعة .
</p>
<ul style="line-height: 1.6;">
<li>قسم للإصدارات الأساسية .</li>
<li>أقسام لقوائم الإصدارات الرسمية .</li>
<li>قسم لتحميل نسخة الباتش .</li>
<li>قسم للأوامر .</li>
<li>قسم للبرامج المقترحة .</li>
<li>قسم للمواقع المقترحة .</li>
<li>قسم للدردشة .</li>
<li>أقسام جانبية أخرى...</li>
</ul>
<p style="line-height: 1.6;">
    • يتم تحديث الإصدار بعد بضع ساعات من صدوره (إلا في حالة تأجيل التحديثات) .<br/>
    • الإصدار 2.0 هو بديل للنسخة القديمة التي أغلقت في 2025/02/07 .<br/>
    • التحديثات داخلية ولا تتطلب تحميل التطبيق من جديد إلا في حالات خاصة .<br/>
</p>
<hr/>
<sifaw style="color: #cccccc; font-size: 14px;">
    ⚠️ هذا التطبيق غير رسمي ولا يتبع Mojang أو Microsoft .
<br/>
    🧱 ماين كرافت هي علامة تجارية مملوكة لمايكروسوفت .
</sifaw>
<hr/>
<div style="margin-top: 25px; text-align: center;">
<a href="https://www.facebook.com/minecraft.bedrock.library?mibextid=ZbWKwL" target="_blank" style="display: inline-block; background-color: #1877f2; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold; font-family: Arial, sans-serif; transition: background-color 0.3s;">
<i class="fab fa-facebook-f" style="margin-right: 8px;margin-lift: 7px;margin-top: 5px;"></i> صفحة التطبيق على الفيسبوك</a>
</div><br>
<hr/>
  
<div id="comments-container">
<style>
#comments-container{font-family:Arial,sans-serif;direction:rtl;width:100%;max-width:800px;height:450px;background-color:#2d3748;border-radius:10px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 4px 6px rgba(0,0,0,.1);margin:20px auto}.comments-header{padding:15px;background-color:#1a202c;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #4a5568}.comments-header button{background-color:#4299e1;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;display:flex;align-items:center;gap:5px;font-size:10px;transition:background-color .3s}.comments-header button:hover{background-color:#3182ce}.comments-body{flex:1;overflow-y:auto;padding:15px;position:relative}.loading-comments{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#cbd5e0}.loading-cat{font-size:40px;animation:jump 1s infinite;display:block;margin-bottom:10px}@keyframes jump{0%,to{transform:translateY(0)}50%{transform:translateY(-20px)}}.error-message{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#e53e3e;text-align:center}.comment-card{background-color:#4a5568;border-radius:8px;padding:15px;margin-bottom:15px;color:#fff;transition:all 0.3s ease}.comment-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}.comment-user-image{width:40px;height:40px;border-radius:50%;object-fit:cover}.comment-user-name{font-weight:700;color:#63b3ed;flex:1;display:flex;align-items:center;gap:5px}.comment-rating{color:#f6e05e;font-size:14px}.comment-text{margin:10px 0;line-height:1.5;color:#e2e8f0}.comment-footer{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:#a0aec0}.comment-actions{display:flex;gap:10px}.comment-actions button{background:none;border:none;color:#a0aec0;cursor:pointer;font-size:14px;display:flex;align-items:center;gap:3px}.comment-actions button:hover{color:#4299e1}.comment-actions button.liked{color:#e53e3e}.likes-count{margin-right:5px}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content{background-color:#2d3748;padding:20px;border-radius:8px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto;direction:rtl;text-align:right}.modal-header{font-size:18px;font-weight:700;margin-bottom:15px;color:#fff}.modal-form-group{margin-bottom:15px;text-align:right}.modal-form-group label{display:block;margin-bottom:5px;color:#cbd5e0}.modal-form-group input,.modal-form-group textarea{width:100%;padding:8px;border-radius:4px;border:1px solid #4a5568;background-color:#1a202c;color:#fff;font-family:Arial,sans-serif;text-align:right}.modal-form-group textarea{min-height:100px;resize:vertical}.char-counter{font-size:12px;color:#a0aec0;text-align:left;margin-top:3px}.modal-actions{display:flex;justify-content:flex-start;gap:10px;margin-top:20px}.modal-actions button{padding:8px 15px;border-radius:4px;border:none;cursor:pointer;display:flex;align-items:center;gap:5px}.submit-btn{background-color:#4299e1;color:#fff}.submit-btn:hover{background-color:#3182ce}.cancel-btn{background-color:#4a5568;color:#fff}.cancel-btn:hover{background-color:#2d3748}.delete-btn{background-color:#e53e3e;color:#fff}.delete-btn:hover{background-color:#c53030}.rating-stars{display:flex;justify-content:flex-end;gap:5px;margin-bottom:15px}.rating-star{font-size:24px;color:#f6e05e;cursor:pointer}.average-rating{display:flex;align-items:center;gap:5px;color:#f6e05e;font-size:11px}.average-rating-value{font-weight:700}.image-selector-btn{background-color:#4a5568;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;display:flex;align-items:center;gap:5px;margin-bottom:15px;direction:rtl}.image-selector-btn:hover{background-color:#2d3748}.image-selector-modal{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1001}.image-selector-content{background-color:#2d3748;padding:20px;border-radius:8px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto;direction:rtl}.image-options{display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;justify-content:flex-end}.image-option{width:60px;height:60px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid transparent;transition:transform .2s}.image-option:hover{transform:scale(1.1)}.image-option.selected{border-color:#4299e1;transform:scale(1.1)}.sort-option{display:flex;align-items:center;gap:5px;color:#cbd5e0;cursor:pointer}.sort-option:hover{color:#4299e1}.selected-image-preview{width:50px;height:50px;border-radius:50%;object-fit:cover;margin-right:10px;border:2px solid #4299e1}.upload-image-btn {background-color:#4a5568;color:#fff;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;display:flex;align-items:center;gap:5px;margin:15px 0;width:100%;justify-content:center}.upload-image-btn:hover{background-color:#2d3748}.upload-input{display:none}.upload-status{margin-top:10px;color:#cbd5e0;text-align:center}.uploading{display:inline-block;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.verified-badge {color: #10b981;font-size: 14px;margin-right: 3px;}.replies-section {margin-top: 15px;padding-top: 15px;border-top: 1px solid #718096;}.reply-btn {background: none;border: none;color: #a0aec0;cursor: pointer;font-size: 12px;display: flex;align-items: center;gap: 5px;margin-bottom: 0px;}.reply-btn:hover {color: #4299e1;}.replies-container {margin-top: 10px;}.reply-card {background-color: #3a4556;border-radius: 6px;padding: 12px;margin-bottom: 10px;color: #fff;font-size: 0.9em;}.reply-header {display: flex;align-items: center;gap: 8px;margin-bottom: 8px;}.reply-user-image {width: 30px;height: 30px;border-radius: 50%;object-fit: cover;}.reply-user-name {font-weight: 600;color: #63b3ed;flex: 1;display: flex;align-items: center;gap: 5px;font-size: 0.9em;}.reply-text {margin: 8px 0;line-height: 1.4;color: #e2e8f0;font-size: 0.9em;}.reply-footer {display: flex;justify-content: space-between;align-items: center;font-size: 11px;color: #a0aec0;}.reply-actions {display: flex;gap: 8px;}.reply-actions button {background: none;border: none;color: #a0aec0;cursor: pointer;font-size: 12px;display: flex;align-items: center;gap: 3px;}.reply-actions button:hover {color: #4299e1;}.reply-actions button.liked {color: #e53e3e;}.no-replies {text-align: center;color: #a0aec0;font-style: italic;padding: 10px;font-size: 0.9em;}.expanded {margin-bottom: 20px;}.reply-count {color: white;border-radius: 50%;width: 20px;height: 20px;display: inline-flex;align-items: center;justify-content: center;font-size: 14px;margin-right: 5px;}
</style>
<div class="comments-header">
<button id="sort-comments-btn">
<i class="fas fa-sort"></i>
<span id="sort-text">الأحدث أولاً</span>
</button>
<div class="average-rating">
<span class="average-rating-value">0.0</span>
<i class="fas fa-star"></i>
<span>(0 تقييمات)</span>
</div>
<button id="add-comment-btn">
<i class="fas fa-plus"></i>إرسال تعليق
</button>
</div>
<div class="comments-body" id="comments-list">
<div class="loading-comments">
<span class="loading-cat">🐈‍⬛</span>جاري تحميل التعليقات...
</div>
</div>
<script>
const BIN_ID="686249f38561e97a502ebca0",API_KEY="$2a$10$F5TR7pSKPRRNAeBzsdxQ4.NYog8xHGUi0hektkor0q/QWFVXzba3q",BASE_URL=`https://api.jsonbin.io/v3/b/${BIN_ID}`,commentsList=document.getElementById("comments-list"),addCommentBtn=document.getElementById("add-comment-btn"),sortCommentsBtn=document.getElementById("sort-comments-btn"),sortText=document.getElementById("sort-text");let comments=[],isNewestFirst=!0,editCommentId=null,replyCommentId=null,likedComments=JSON.parse(localStorage.getItem("liked_comments"))||[],likedReplies=JSON.parse(localStorage.getItem("liked_replies"))||[];const imageOptions=[
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/minecraft.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/bedrock.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/steve.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/end_dragon.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/enderman.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/snow_golem.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/villager.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/ghast.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/creeper.png",
"https://raw.githubusercontent.com/tamaa-pro/minecraft_bedrock_library/refs/heads/main/data/users_icon/chicken_joke.png"];
const CLOUD_NAME = 'tamaa';const API_KEY_CLOUDINARY = '299481434614369';const UPLOAD_PRESET = 'users_avatars';const VERIFICATION_KEY = 'ⴵ';let selectedImage = localStorage.getItem("comment_userImage") || imageOptions[0];let uploadedImages = JSON.parse(localStorage.getItem("uploaded_images")) || [];async function loadComments(){try{const e=await fetch(BASE_URL,{headers:{"X-Master-Key":API_KEY}});if(!e.ok)throw new Error("Failed to load comments");const t=await e.json();comments=t.record?.comments||[],renderComments(),updateAverageRating()}catch(e){console.error("Error loading comments:",e),showError()}}async function saveComments(){try{if(!(await fetch(BASE_URL,{method:"PUT",headers:{"Content-Type":"application/json","X-Master-Key":API_KEY},body:JSON.stringify({comments:comments})})).ok)throw new Error("Failed to save comments");return!0}catch(e){return console.error("Error saving comments:",e),!1}}function renderComments(){if(0===comments.length)return void(commentsList.innerHTML='<div style="text-align: center; color: #cbd5e0;">لا توجد تعليقات بعد</div>');const e=[...comments];e.sort(((e,t)=>{const n=new Date(e.date),a=new Date(t.date);return isNewestFirst?a-n:n-a})),commentsList.innerHTML="",e.forEach((e=>{const t=document.createElement("div");t.className="comment-card",t.dataset.id=e.id;const n=new Date(e.date),a=`${n.getFullYear()}/${String(n.getMonth()+1).padStart(2,"0")}/${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}`;let s="";e.rating&&(s="★".repeat(e.rating)+"☆".repeat(5-e.rating));const o=likedComments.includes(e.id);t.innerHTML=`\n          <div class="comment-header">\n            <img src="${e.userImage||imageOptions[0]}" alt="User" class="comment-user-image">\n            <span class="comment-user-name">${e.username}${e.verified?' <i class="fas fa-check-circle verified-badge" title="حساب موثوق"></i>':''}</span>\n            ${e.rating?`<span class="comment-rating">${s}</span>`:""}\n          </div>\n          <div class="comment-text">${e.text}</div>\n          <div class="comment-footer">\n            <span>${a}</span>\n            <div class="comment-actions">\n              <button class="like-btn ${o?"liked":""}" data-id="${e.id}">\n                <i class="fas fa-heart"></i>\n                <span class="likes-count">${e.likes||0}</span>\n              </button>\n              <button class="reply-btn" data-id="${e.id}">
  <i class="fas fa-reply"></i>
  ${e.replies && e.replies.length > 0 ? `<span class="reply-count">${e.replies.length}</span>` : ''}
</button>\n              <button class="edit-btn" data-id="${e.id}">\n                <i class="fas fa-edit"></i>\n              </button>\n            </div>\n          </div>\n        `;const repliesSection = document.createElement('div');repliesSection.className = 'replies-section';repliesSection.style.display = 'none';const replyButton = document.createElement('button');replyButton.className = 'reply-btn';replyButton.innerHTML = '<i class="fas fa-reply"></i> رد على التعليق';replyButton.addEventListener('click', () => {replyCommentId = e.id;showReplyModal();});repliesSection.appendChild(replyButton);const repliesContainer = document.createElement('div');repliesContainer.className = 'replies-container';if (e.replies && e.replies.length > 0) {e.replies.forEach(reply => {const replyCard = createReplyCard(reply, e.id);repliesContainer.appendChild(replyCard);});} else {const noReplies = document.createElement('div');noReplies.className = 'no-replies';noReplies.textContent = 'لم يتم الرد على هذا التعليق حتى الآن';repliesContainer.appendChild(noReplies);} repliesSection.appendChild(repliesContainer);t.appendChild(repliesSection);commentsList.appendChild(t);t.querySelector(".like-btn").addEventListener("click",(()=>handleLike(e.id)));t.querySelector(".reply-btn").addEventListener("click",(()=>{const isExpanded = repliesSection.style.display === 'block';repliesSection.style.display = isExpanded ? 'none' : 'block';t.classList.toggle('expanded', !isExpanded);}));t.querySelector(".edit-btn").addEventListener("click",(()=>showEditPasswordModal(e.id)));}))}function createReplyCard(reply, commentId) {const replyCard = document.createElement('div');replyCard.className = 'reply-card';replyCard.dataset.id = reply.id;const replyDate = new Date(reply.date);const formattedDate = `${replyDate.getFullYear()}/${String(replyDate.getMonth()+1).padStart(2,"0")}/${String(replyDate.getDate()).padStart(2,"0")} ${String(replyDate.getHours()).padStart(2,"0")}:${String(replyDate.getMinutes()).padStart(2,"0")}`;const isLiked = likedReplies.includes(reply.id);replyCard.innerHTML = `
<div class="reply-header">
<img src="${reply.userImage||imageOptions[0]}" alt="User" class="reply-user-image">
<span class="reply-user-name">${reply.username}${reply.verified?' <i class="fas fa-check-circle verified-badge" title="حساب موثوق"></i>':''}</span>
</div>
<div class="reply-text">${reply.text}</div>
<div class="reply-footer">
<span>${formattedDate}</span>
<div class="reply-actions">
<button class="like-reply-btn ${isLiked?"liked":""}" data-id="${reply.id}" data-comment="${commentId}">
<i class="fas fa-heart"></i>
<span class="likes-count">${reply.likes||0}</span>
</button>
<button class="edit-reply-btn" data-id="${reply.id}" data-comment="${commentId}">
<i class="fas fa-edit"></i>
</button>
</div>
</div>
  `;replyCard.querySelector('.like-reply-btn').addEventListener('click', (event) => {event.stopPropagation();handleReplyLike(reply.id, commentId);});replyCard.querySelector('.edit-reply-btn').addEventListener('click', (event) => {event.stopPropagation();showEditReplyPasswordModal(reply.id, commentId);});return replyCard;} function showError(){commentsList.innerHTML='<div class="error-message">خطأ في تحميل التعليقات</div>'}function toggleSortOrder(){isNewestFirst=!isNewestFirst,sortText.textContent=isNewestFirst?"الأحدث أولاً":"الأقدم أولاً",renderComments()}function showAddCommentModal(){const e=localStorage.getItem("comment_username")||"",n=document.createElement("div");n.className="modal-overlay",n.innerHTML=`\n        <div class="modal-content">\n          <div class="modal-header">إرسال تعليق جديد</div>\n          <div class="modal-form-group">\n            <label for="comment-username">اسم المستخدم</label>\n            <input type="text" id="comment-username" maxlength="15" value="${e}">\n            <div class="char-counter"><span id="username-counter">0</span>/15</div>\n          </div>\n          \n          <button type="button" class="image-selector-btn" id="open-image-selector">\n            <i class="fas fa-image"></i> اختيار صورة الحساب\n            <img src="${selectedImage}" class="selected-image-preview">\n          </button>\n          \n          <div class="modal-form-group">\n            <label for="comment-text">التعليق</label>\n            <textarea id="comment-text" maxlength="200"></textarea>\n            <div class="char-counter"><span id="text-counter">0</span>/200</div>\n          </div>\n          \n          <div class="modal-form-group">\n            <label for="comment-password">كلمة المرور (لتعديل أو حذف التعليق لاحقًا)</label>\n            <input type="text" id="comment-password" maxlength="17">\n            <div class="char-counter"><span id="password-counter">0</span>/17</div>\n          </div>\n          \n          <div class="rating-stars">\n            <span class="rating-star" data-rating="5">✩</span>\n            <span class="rating-star" data-rating="4">✩</span>\n            <span class="rating-star" data-rating="3">✩</span>\n            <span class="rating-star" data-rating="2">✩</span>\n            <span class="rating-star" data-rating="1">✩</span>\n            <button id="toggle-rating-btn" style="background: none; border: none; color: #cbd5e0; cursor: pointer;">\n              <i class="fas fa-star"></i> أضف تقييم\n            </button>\n          </div>\n          \n          <div class="modal-actions">\n            <button class="cancel-btn" id="cancel-comment-btn">\n              <i class="fas fa-times"></i> إلغاء\n            </button>\n            <button class="submit-btn" id="submit-comment-btn">\n              <i class="fas fa-paper-plane"></i> نشر التعليق\n            </button>\n          </div>\n        </div>\n      `,document.body.appendChild(n),document.getElementById("comment-username").addEventListener("input",(e=>{document.getElementById("username-counter").textContent=e.target.value.length})),document.getElementById("comment-text").addEventListener("input",(e=>{document.getElementById("text-counter").textContent=e.target.value.length})),document.getElementById("comment-password").addEventListener("input",(e=>{document.getElementById("password-counter").textContent=e.target.value.length})),document.getElementById("username-counter").textContent=e.length,document.getElementById("text-counter").textContent=0,document.getElementById("password-counter").textContent=0,document.getElementById("cancel-comment-btn").addEventListener("click",(()=>{document.body.removeChild(n)})),document.getElementById("submit-comment-btn").addEventListener("click",submitComment),document.getElementById("open-image-selector").addEventListener("click",(()=>{showImageSelector(selectedImage)}));let a=0;const s=document.querySelectorAll(".rating-star");s.forEach((e=>{e.addEventListener("click",(()=>{const t=parseInt(e.dataset.rating);a=t,s.forEach(((e,n)=>{e.textContent=n<5-t?"✩":"★"}))}))}));const o=document.getElementById("toggle-rating-btn");document.querySelector(".rating-stars");let d=!1;o.addEventListener("click",(()=>{d=!d,s.forEach((e=>{e.style.display=d?"inline-block":"none"})),o.innerHTML=d?'<i class="fas fa-times"></i> إخفاء التقييم':'<i class="fas fa-star"></i> أضف تقييم'})),s.forEach((e=>{e.style.display="none"}))}function showImageSelector(e){const t=document.createElement("div");t.className="image-selector-modal",t.innerHTML=`\n        <div class="image-selector-content">\n          <div class="modal-header">اختر صورة الحساب</div>\n          <div class="image-options">\n            ${imageOptions.map(((t,n)=>`\n              <img src="${t}" class="image-option ${t===e?"selected":""}" \n                   data-img="${t}" alt="Option ${n+1}">\n            `)).join("")}\n            ${uploadedImages.map(((t,n)=>`\n              <img src="${t}" class="image-option ${t===e?"selected":""}" \n                   data-img="${t}" alt="Uploaded ${n+1}">\n            `)).join("")}\n          </div>\n          \n          <!-- زر رفع صورة جديد -->\n          <button type="button" class="upload-image-btn" id="upload-image-btn">\n            <i class="fas fa-upload"></i> اختيار صورة من الجهاز\n          </button>\n          <input type="file" id="image-upload-input" class="upload-input" accept="image/*">\n          <div id="upload-status" class="upload-status"></div>\n          \n          <div class="modal-actions">\n            <button class="cancel-btn" id="cancel-image-selector">\n              <i class="fas fa-times"></i> إلغاء\n            </button>\n            <button class="submit-btn" id="select-image-btn">\n              <i class="fas fa-check"></i> تأكيد الاختيار\n            </button>\n          </div>\n        </div>\n      `,document.body.appendChild(t);let n=e;document.querySelectorAll(".image-option").forEach((e=>{e.addEventListener("click",(()=>{document.querySelectorAll(".image-option").forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),n=e.dataset.img}))})),document.getElementById("cancel-image-selector").addEventListener("click",(()=>{document.body.removeChild(t)})),document.getElementById("select-image-btn").addEventListener("click",(()=>{selectedImage = n;const e=document.querySelector(".selected-image-preview");e&&(e.src=selectedImage),localStorage.setItem("comment_userImage", selectedImage),document.body.removeChild(t)}));document.getElementById('upload-image-btn').addEventListener('click', () => {document.getElementById('image-upload-input').click();});document.getElementById('image-upload-input').addEventListener('change', handleImageUpload);} async function handleImageUpload(event) {const file = event.target.files[0];if (!file) return;const statusElement = document.getElementById('upload-status');statusElement.innerHTML = '<i class="fas fa-spinner uploading"></i> جاري رفع الصورة...';try {const imageUrl = await uploadToCloudinary(file);statusElement.innerHTML = '<i class="fas fa-check" style="color: green;"></i> تم رفع الصورة بنجاح';selectedImage = imageUrl;const previewImage = document.querySelector(".selected-image-preview");if (previewImage) {previewImage.src = imageUrl;} localStorage.setItem("comment_userImage", imageUrl);if (!uploadedImages.includes(imageUrl)) {uploadedImages.push(imageUrl);localStorage.setItem("uploaded_images", JSON.stringify(uploadedImages));} const imageOptionsElements = document.querySelectorAll('.image-option');imageOptionsElements.forEach(option => option.classList.remove('selected'));const newImageOption = document.createElement('img');newImageOption.src = imageUrl;newImageOption.className = 'image-option selected';newImageOption.dataset.img = imageUrl;newImageOption.addEventListener('click', () => {document.querySelectorAll('.image-option').forEach(opt => opt.classList.remove('selected'));newImageOption.classList.add('selected');selectedImage = imageUrl;localStorage.setItem("comment_userImage", imageUrl);});document.querySelector('.image-options').appendChild(newImageOption);} catch (error) {console.error('Error uploading image:', error);statusElement.innerHTML = '<i class="fas fa-times" style="color: red;"></i> فشل في رفع الصورة: ' + error.message;}} async function uploadToCloudinary(file) {const formData = new FormData();formData.append('file', file);formData.append('upload_preset', UPLOAD_PRESET);formData.append('api_key', API_KEY_CLOUDINARY);try {const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/upload`, {method: 'POST',body: formData});if (!response.ok) {throw new Error('فشل في رفع الصورة: ' + response.statusText);} const data = await response.json();return data.secure_url;} catch (error) {console.error('Error uploading image:', error);throw new Error('حدث خطأ أثناء رفع الصورة. يرجى المحاولة مرة أخرى.');
}} function showReplyModal() {const username = localStorage.getItem("comment_username") || "";const modal = document.createElement("div");modal.className = "modal-overlay";modal.innerHTML = `
<div class="modal-content">
<div class="modal-header">رد على التعليق</div>
<div class="modal-form-group">
<label for="reply-username">اسم المستخدم</label>
<input type="text" id="reply-username" maxlength="15" value="${username}">
<div class="char-counter"><span id="reply-username-counter">0</span>/15</div>
</div>
<button type="button" class="image-selector-btn" id="open-reply-image-selector">
<i class="fas fa-image"></i> اختيار صورة الحساب
<img src="${selectedImage}" class="selected-image-preview">
</button>
<div class="modal-form-group">
<label for="reply-text">الرد</label>
<textarea id="reply-text" maxlength="200"></textarea>
<div class="char-counter"><span id="reply-text-counter">0</span>/200</div>
</div>
<div class="modal-form-group">
<label for="reply-password">كلمة المرور (لتعديل أو حذف الرد لاحقًا)</label>
<input type="text" id="reply-password" maxlength="17">
<div class="char-counter"><span id="reply-password-counter">0</span>/17</div>
</div>
<div class="modal-actions">
<button class="cancel-btn" id="cancel-reply-btn">
<i class="fas fa-times"></i> إلغاء
</button>
<button class="submit-btn" id="submit-reply-btn">
<i class="fas fa-paper-plane"></i> نشر الرد
</button>
</div>
</div>
  `;document.body.appendChild(modal);document.getElementById("reply-username").addEventListener("input",(e=>{document.getElementById("reply-username-counter").textContent=e.target.value.length}));document.getElementById("reply-text").addEventListener("input",(e=>{document.getElementById("reply-text-counter").textContent=e.target.value.length}));document.getElementById("reply-password").addEventListener("input",(e=>{document.getElementById("reply-password-counter").textContent=e.target.value.length}));document.getElementById("reply-username-counter").textContent = username.length;document.getElementById("reply-text-counter").textContent = 0;document.getElementById("reply-password-counter").textContent = 0;document.getElementById("cancel-reply-btn").addEventListener("click",(()=>{document.body.removeChild(modal);replyCommentId = null;}));document.getElementById("submit-reply-btn").addEventListener("click", submitReply);document.getElementById("open-reply-image-selector").addEventListener("click",(()=>{showImageSelector(selectedImage);}));} async function submitReply() {const username = document.getElementById("reply-username")?.value.trim();const text = document.getElementById("reply-text")?.value.trim();const password = document.getElementById("reply-password")?.value.trim();if (!username || !text || !password) {return void alert("الرجاء ملء جميع الحقول المطلوبة");} if (username.length > 15) {return void alert("اسم المستخدم يجب أن لا يتجاوز 15 حرفًا");} if (text.length > 200) {return void alert("الرد يجب أن لا يتجاوز 200 حرف");}if (password.length > 17) {return void alert("كلمة المرور يجب أن لا تتجاوز 17 حرفًا");} let finalUsername = username;let verified = false;if (username.includes(VERIFICATION_KEY)) {finalUsername = username.replace(VERIFICATION_KEY, '').trim();verified = true;} const reply = {id: generateId(),username: finalUsername,text: text,password: password,date: (new Date()).toISOString(),userImage: selectedImage,likes: 0,verified: verified};const commentIndex = comments.findIndex(c => c.id === replyCommentId);if (commentIndex !== -1) {if (!comments[commentIndex].replies) {comments[commentIndex].replies = [];} comments[commentIndex].replies.unshift(reply);} localStorage.setItem("comment_username", finalUsername);localStorage.setItem("comment_userImage", selectedImage);if (await saveComments()) {document.querySelector(".modal-overlay")?.remove();renderComments();replyCommentId = null;} else {alert("حدث خطأ أثناء حفظ الرد");}} async function handleReplyLike(replyId, commentId) {const comment = comments.find(c => c.id === commentId);if (!comment || !comment.replies) return;const reply = comment.replies.find(r => r.id === replyId);if (!reply) return;const index = likedReplies.indexOf(replyId);if (index === -1) {reply.likes = (reply.likes || 0) + 1;likedReplies.push(replyId);} else {reply.likes = Math.max(0, (reply.likes || 0) - 1);likedReplies.splice(index, 1);} localStorage.setItem("liked_replies", JSON.stringify(likedReplies));if (await saveComments()) {renderComments();}} function showEditReplyPasswordModal(replyId, commentId) {const modal = document.createElement("div");modal.className = "modal-overlay";modal.innerHTML = `
<div class="modal-content">
<div class="modal-header">تعديل الرد</div>
<div class="modal-form-group">
<label for="edit-reply-password">كلمة المرور</label>
<input type="text" id="edit-reply-password" placeholder="أدخل كلمة المرور المستخدمة عند النشر">
</div>
<div class="modal-actions">
<button class="cancel-btn" id="cancel-edit-reply-btn">
<i class="fas fa-times"></i> إلغاء
</button>
<button class="submit-btn" id="verify-edit-reply-btn" data-reply="${replyId}" data-comment="${commentId}">
<i class="fas fa-check"></i> تأكيد
</button>
</div>
</div>
  `;document.body.appendChild(modal);document.getElementById("cancel-edit-reply-btn").addEventListener("click", (() => {document.body.removeChild(modal);}));document.getElementById("verify-edit-reply-btn").addEventListener("click", (() => {const password = document.getElementById("edit-reply-password").value.trim();verifyEditReplyPassword(replyId, commentId, password);}));} function verifyEditReplyPassword(replyId, commentId, password) {const comment = comments.find(c => c.id === commentId);if (!comment || !comment.replies) {alert("الرد غير موجود");return void document.querySelector(".modal-overlay")?.remove();} const reply = comment.replies.find(r => r.id === replyId);if (!reply) {alert("الرد غير موجود");return void document.querySelector(".modal-overlay")?.remove();} if (reply.password === password) {document.querySelector(".modal-overlay")?.remove();showEditReplyModal(reply, commentId);} else {alert("كلمة المرور غير صحيحة");}} function showEditReplyModal(reply, commentId) {const modal = document.createElement("div");modal.className = "modal-overlay";modal.innerHTML = `
<div class="modal-content">
<div class="modal-header">تعديل الرد</div>
<div class="modal-form-group">
<label for="edit-reply-username">اسم المستخدم</label>
<input type="text" id="edit-reply-username" maxlength="15" value="${reply.username}${reply.verified ? VERIFICATION_KEY : ''}">
<div class="char-counter"><span id="edit-reply-username-counter">${reply.username.length}</span>/15</div>
<button type="button" class="image-selector-btn" id="open-edit-reply-image-selector">
<i class="fas fa-image"></i> اختيار صورة الحساب
<img src="${reply.userImage || imageOptions[0]}" class="selected-image-preview">
</button>
<div class="modal-form-group">
<label for="edit-reply-text">الرد</label>
<textarea id="edit-reply-text" maxlength="200">${reply.text}</textarea>
<div class="char-counter"><span id="edit-reply-text-counter">${reply.text.length}</span>/200</div>
</div>
<div class="modal-form-group">
<label for="edit-reply-password">كلمة المرور</label>
<input type="text" id="edit-reply-password" maxlength="17" value="${reply.password}">
<div class="char-counter"><span id="edit-reply-password-counter">${reply.password.length}</span>/17</div>
</div>
<div class="modal-actions">
<button class="cancel-btn" id="cancel-edit-reply-comment-btn">
<i class="fas fa-times"></i> إلغاء
</button>
<button class="delete-btn" id="delete-reply-btn" data-reply="${reply.id}" data-comment="${commentId}">
<i class="fas fa-trash"></i> حذف الرد
</button>
<button class="submit-btn" id="submit-edit-reply-btn" data-reply="${reply.id}" data-comment="${commentId}">
<i class="fas fa-save"></i> حفظ التعديلات
</button>
</div>
</div>
  `;document.body.appendChild(modal);document.getElementById("edit-reply-username").addEventListener("input",(e=>{document.getElementById("edit-reply-username-counter").textContent=e.target.value.length}));document.getElementById("edit-reply-text").addEventListener("input",(e=>{document.getElementById("edit-reply-text-counter").textContent=e.target.value.length}));document.getElementById("edit-reply-password").addEventListener("input",(e=>{document.getElementById("edit-reply-password-counter").textContent=e.target.value.length}));document.getElementById("cancel-edit-reply-comment-btn").addEventListener("click", (() => {document.body.removeChild(modal);}));document.getElementById("delete-reply-btn").addEventListener("click", (() => {if (confirm("هل أنت متأكد من حذف هذا الرد؟")) {deleteReply(reply.id, commentId);}}));document.getElementById("submit-edit-reply-btn").addEventListener("click", (() => {submitReplyEdit(reply.id, commentId);}));document.getElementById("open-edit-reply-image-selector").addEventListener("click",(() => {showImageSelector(document.querySelector("#open-edit-reply-image-selector .selected-image-preview").src);}));} async function submitReplyEdit(replyId, commentId) {const username = document.getElementById("edit-reply-username")?.value.trim();const text = document.getElementById("edit-reply-text")?.value.trim();const password = document.getElementById("edit-reply-password")?.value.trim();const userImage = selectedImage;if (!username || !text || !password) {return void alert("الرجاء ملء جميع الحقول المطلوبة");} if (username.length > 15) {return void alert("اسم المستخدم يجب أن لا يتجاوز 15 حرفًا");} if (text.length > 200) {return void alert("الرد يجب أن لا يتجاوز 200 حرف");} if (password.length > 17) {return void alert("كلمة المرور يجب أن لا تتجاوز 17 حرفًا");} let finalUsername = username;let verified = false;if (username.includes(VERIFICATION_KEY)) {finalUsername = username.replace(VERIFICATION_KEY, '').trim();verified = true;} const comment = comments.find(c => c.id === commentId);if (!comment || !comment.replies) {return void alert("التعليق غير موجود");} const replyIndex = comment.replies.findIndex(r => r.id === replyId);if (replyIndex === -1) {return void alert("الرد غير موجود");} comment.replies[replyIndex] = {...comment.replies[replyIndex],username: finalUsername,text: text,password: password,userImage: userImage,verified: verified};localStorage.setItem("comment_username", finalUsername);localStorage.setItem("comment_userImage", userImage);if (await saveComments()) {document.querySelector(".modal-overlay")?.remove();renderComments();} else {alert("حدث خطأ أثناء حفظ التعديلات");}} async function deleteReply(replyId, commentId) {const comment = comments.find(c => c.id === commentId);if (!comment || !comment.replies) return;comment.replies = comment.replies.filter(r => r.id !== replyId);if (await saveComments()) {document.querySelector(".modal-overlay")?.remove();renderComments();} else {alert("حدث خطأ أثناء حذف الرد");}} async function submitComment(){const e=document.getElementById("comment-username")?.value.trim()||document.getElementById("edit-username")?.value.trim(),t=document.getElementById("comment-text")?.value.trim()||document.getElementById("edit-text")?.value.trim(),n=document.getElementById("comment-password")?.value.trim()||document.getElementById("edit-password")?.value.trim();let a=selectedImage||imageOptions[0];let o=0;if(document.querySelectorAll(".rating-star").forEach((e=>{"★"===e.textContent&&(o=Math.max(o,parseInt(e.dataset.rating)))})),!e||!t||!n)return void alert("الرجاء ملء جميع الحقول المطلوبة");if(e.length>15)return void alert("اسم المستخدم يجب أن لا يتجاوز 15 حرفًا");if(t.length>200)return void alert("التعليق يجب أن لا يتجاوز 200 حرف");if(n.length>17)return void alert("كلمة المرور يجب أن لا تتجاوز 17 حرفًا");let username = e;let verified = false;if (username.includes(VERIFICATION_KEY)) {username = username.replace(VERIFICATION_KEY, '').trim();verified = true;} const d={id:editCommentId||generateId(),username:username,text:t,password:n,date:(new Date).toISOString(),userImage:a,likes:0,rating:o||void 0,verified:verified,replies: editCommentId ? comments.find(c => c.id === editCommentId)?.replies || [] : [] };if(editCommentId){const e=comments.findIndex((e=>e.id===editCommentId));-1!==e&&(d.likes=comments[e].likes,d.date=comments[e].date,comments[e]=d)}else{comments.unshift(d);} localStorage.setItem("comment_username",username);localStorage.setItem("comment_userImage",a);await saveComments()?(document.querySelector(".modal-overlay")?.remove(),renderComments(),updateAverageRating(),editCommentId=null):alert("حدث خطأ أثناء حفظ التعليق");} function showEditPasswordModal(e){const t=document.createElement("div");t.className="modal-overlay",t.innerHTML='\n        <div class="modal-content">\n          <div class="modal-header">تعديل التعليق</div>\n          <div class="modal-form-group">\n            <label for="edit-password">كلمة المرور</label>\n            <input type="text" id="edit-password" placeholder="أدخل كلمة المرور المستخدمة عند النشر">\n          </div>\n          <div class="modal-actions">\n            <button class="cancel-btn" id="cancel-edit-btn">\n              <i class="fas fa-times"></i> إلغاء\n            </button>\n            <button class="submit-btn" id="verify-edit-btn">\n              <i class="fas fa-check"></i> تأكيد\n            </button>\n          </div>\n        </div>\n      ',document.body.appendChild(t),document.getElementById("cancel-edit-btn").addEventListener("click",(()=>{document.body.removeChild(t)})),document.getElementById("verify-edit-btn").addEventListener("click",(()=>{verifyEditPassword(e)}))}async function verifyEditPassword(e){const t=document.getElementById("edit-password").value.trim(),n=comments.find((t=>t.id===e));if(!n)return alert("التعليق غير موجود"),void document.querySelector(".modal-overlay")?.remove();n.password===t?(document.querySelector(".modal-overlay")?.remove(),editCommentId=e,showEditCommentModal(n)):alert("كلمة المرور غير صحيحة")}function showEditCommentModal(e){const t=document.createElement("div");if(t.className="modal-overlay",t.innerHTML=`\n        <div class="modal-content">\n          <div class="modal-header">تعديل التعليق</div>\n          <div class="modal-form-group">\n            <label for="edit-username">اسم المستخدم</label>\n            <input type="text" id="edit-username" maxlength="15" value="${e.username}${e.verified?VERIFICATION_KEY:''}">\n            <div class="char-counter"><span id="edit-username-counter">${e.username.length}</span>/15</div>\n          </div>\n          \n          <button type="button" class="image-selector-btn" id="open-edit-image-selector">\n            <i class="fas fa-image"></i> اختيار صورة الحساب\n            <img src="${e.userImage||imageOptions[0]}" class="selected-image-preview">\n          </button>\n          \n          <div class="modal-form-group">\n            <label for="edit-text">التعليق</label>\n            <textarea id="edit-text" maxlength="200">${e.text}</textarea>\n            <div class="char-counter"><span id="edit-text-counter">${e.text.length}</span>/200</div>\n          </div>\n          \n          <div class="modal-form-group">\n            <label for="edit-password">كلمة المرور</label>\n            <input type="text" id="edit-password" maxlength="17" value="${e.password}">\n            <div class="char-counter"><span id="edit-password-counter">${e.password.length}</span>/17</div>\n          </div>\n          \n          ${e.rating?`\n            <div class="rating-stars">\n              <span class="rating-star" data-rating="5">${e.rating>=5?"★":"✩"}</span>\n              <span class="rating-star" data-rating="4">${e.rating>=4?"★":"✩"}</span>\n              <span class="rating-star" data-rating="3">${e.rating>=3?"★":"✩"}</span>\n              <span class="rating-star" data-rating="2">${e.rating>=2?"★":"✩"}</span>\n              <span class="rating-star" data-rating="1">${e.rating>=1?"★":"✩"}</span>\n            </div>\n          `:""}\n          \n          <div class="modal-actions">\n            <button class="cancel-btn" id="cancel-edit-comment-btn">\n              <i class="fas fa-times"></i> إلغاء\n            </button>\n            <button class="delete-btn" id="delete-comment-btn">\n              <i class="fas fa-trash"></i> حذف التعليق\n            </button>\n            <button class="submit-btn" id="submit-edit-btn">\n              <i class="fas fa-save"></i> حفظ التعديلات\n            </button>\n          </div>\n        </div>\n      `,document.body.appendChild(t),document.getElementById("edit-username").addEventListener("input",(e=>{document.getElementById("edit-username-counter").textContent=e.target.value.length})),document.getElementById("edit-text").addEventListener("input",(e=>{document.getElementById("edit-text-counter").textContent=e.target.value.length})),document.getElementById("edit-password").addEventListener("input",(e=>{document.getElementById("edit-password-counter").textContent=e.target.value.length})),document.getElementById("cancel-edit-comment-btn").addEventListener("click",(()=>{document.body.removeChild(t),editCommentId=null})),document.getElementById("delete-comment-btn").addEventListener("click",(()=>{confirm("هل أنت متأكد من حذف هذا التعليق؟")&&deleteComment(e.id)})),document.getElementById("submit-edit-btn").addEventListener("click",submitComment),document.getElementById("open-edit-image-selector").addEventListener("click",(()=>{showImageSelector(document.querySelector("#open-edit-image-selector .selected-image-preview").src)})),e.rating){let t=e.rating;const n=document.querySelectorAll(".rating-star");n.forEach((e=>{e.addEventListener("click",(()=>{const a=parseInt(e.dataset.rating);t=a,n.forEach(((e,t)=>{e.textContent=t<5-a?"✩":"★"}))}))}))}}async function deleteComment(e){comments=comments.filter((t=>t.id!==e));await saveComments()?(document.querySelector(".modal-overlay")?.remove(),renderComments(),updateAverageRating(),editCommentId=null):alert("حدث خطأ أثناء حذف التعليق")}async function handleLike(e){const t=comments.find((t=>t.id===e));if(!t)return;const n=likedComments.indexOf(e);-1===n?(t.likes=(t.likes||0)+1,likedComments.push(e)):(t.likes=Math.max(0,(t.likes||0)-1),likedComments.splice(n,1)),localStorage.setItem("liked_comments",JSON.stringify(likedComments));await saveComments()&&renderComments()}function updateAverageRating(){const e=comments.filter((e=>e.rating)),t=e.reduce(((e,t)=>e+t.rating),0),n=e.length>0?(t/e.length).toFixed(1):0;document.querySelector(".average-rating-value").textContent=n,document.querySelector(".average-rating span:last-child").textContent=`(${e.length} تقييم${1!==e.length?"ات":""})`}function generateId(){return Math.random().toString(36).substr(2,9)}document.addEventListener("DOMContentLoaded",(()=>{const e=document.createElement("script");e.src="https://kit.fontawesome.com/a076d05399.js",e.crossOrigin="anonymous",document.head.appendChild(e),loadComments(),addCommentBtn.addEventListener("click",showAddCommentModal),sortCommentsBtn.addEventListener("click",toggleSortOrder)}));
</script>
</div>
  
<hr/>
<style>
#infoPanel{max-height:800px;overflow:hidden;transition:max-height .4s ease;background:#1e1e1e;color:#ddd;font-size:14px;padding:10px 15px;border-top:1px solid #444}
.owner-container{background:#111;padding:20px;margin:10px 0;border-radius:8px;display:flex;justify-content:space-around;align-items:center}
.owner-card{display:flex;flex-direction:column;align-items:center;width:150px}
.owner-circle{width:120px;height:120px;border-radius:50%;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-bottom:10px;position:relative;cursor:pointer;-webkit-tap-highlight-color:transparent}
.owner-circle img{pointer-events:none}
.owner-circle-tamaa img{width:80%;height:80%;object-fit:contain}
.owner-circle-sifaw img{width:100%;height:100%;object-fit:cover}
.owner-label{text-align:center;font-size:12px;color:#ddd;padding:5px 0}
.loading-spinner{position:absolute;width:50px !important;height:50px !important;z-index:2}
</style>
<div id="infoPanel">
<info style="color: #9933CC;font-size:18px;">حول صفحة التحميل :</info><br>
<sifaw style="font-size:13px;">تاريخ إنشاء الصفحة : 2025/06/01</sifaw><br>
<sifaw style="font-size:13px;">تاريخ آخر تحديث للصفحة : 2025/10/20</sifaw><br>
<sifaw style="font-size:13px;">رمز آخر تعديل للصفحة : (14:20)-103</sifaw><br>
<sifaw style="font-size:13px;">تاريخ آخر تحديث لحزمة التطبيق (2.5) : 2025/07/04</sifaw><br>
<sifaw style="font-size:13px;">تاريخ الإصدار الأول لحزمة التطبيق (2.0) : 2025/02/07</sifaw><br>
<sifaw style="font-size:13px;">تاريخ الإصدار الأول للنسخة السابقة (1.0) : 2024/06/16</sifaw><br>
<sifaw style="font-size:13px;">تاريخ الإصدار الأول (نسخة البيتا) : 2024/01/07</sifaw><br>
<div class="owner-container">
<div class="owner-card">
<div class="owner-circle owner-circle-tamaa" onclick="window.open('https://tamaa-pro.github.io/minecraft_bedrock_library/error_103','_self')">
<img class="loading-spinner" src="https://raw.githubusercontent.com/tamaa-pro/azro/refs/heads/main/data/pictures/loading/gybr_1.gif" alt="Loading">
<img src="https://tamaa-pro.github.io/azro/data/pictures/tamaa_pro_icon.png" alt="" loading="eager" onload="this.previousElementSibling.style.display='none'">
</div>
<div class="owner-label">تابع لطرف:<br>TAMAA PRO STUDIO</div>
</div>
<div class="owner-card">
<div class="owner-circle owner-circle-sifaw" onclick="window.open('https://www.facebook.com/sifaw.tinsti.div?mibextid=kFxxJD','_blank')">
<img class="loading-spinner" src="https://raw.githubusercontent.com/tamaa-pro/azro/refs/heads/main/data/pictures/loading/gybr_1.gif" alt="Loading">
<img id="sifawImage" src="" alt="">
</div>
<div class="owner-label">المسؤول الحالي:<br>Sifaw Tinsti</div>
</div>
</div>
<button onclick="window.location.href='stats/'"
style="display: inline-flex; align-items: center; justify-content: center; gap: 8px; background-color: #555; color: white; border: none; padding: 8px 101px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; white-space: nowrap;">
<i class="fas fa-chart-line"></i>احصائيات التطبيق
</button>
</div>
<script>
const sifawImages = Array.from({length:84},(_,i)=>`https://tamaa-pro.github.io/azro/data/pictures/sifaw/${i+1}.jpg`).sort(()=>Math.random()-.5);
let currentImg = 0;
function loadSifawImage(){const img = document.getElementById('sifawImage');const spinner = img.previousElementSibling;img.onload = () => spinner.style.display = 'none';img.onerror = () => {img.src = 'https://tamaa-pro.github.io/azro/data/pictures/tamaa_pro_icon.png';spinner.style.display = 'none';};img.src = sifawImages[currentImg];currentImg = (currentImg + 1) % sifawImages.length;}
window.addEventListener('DOMContentLoaded', loadSifawImage);
</script>
<hr/>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const style = document.createElement('style');
  style.textContent = `
    .comment-content {
      position: relative;
      margin-bottom: 10px;
    }
    .comment-media {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .comment-media-item {
      border-radius: 8px;
      background-color: #1a202c;
      object-fit: contain;
    }
    .media-style-1 { width: 100%; max-height: 300px; }
    .media-style-2 { width: 50%; max-height: 200px; align-self: flex-end; }
    .media-style-3 { width: 50%; max-height: 200px; align-self: center; }
    .media-style-4 { width: 50%; max-height: 200px; align-self: flex-start; }
    .media-style-5 { width: 30%; max-height: 150px; align-self: flex-end; }
    .media-style-6 { width: 30%; max-height: 150px; align-self: center; }
    .media-style-7 { width: 30%; max-height: 150px; align-self: flex-start; }
    .media-style-8 { width: calc(100% - 10px); max-height: 300px; border: 2px solid #4299e1; padding: 3px; margin: 0 5px; }
    .comment-links {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }
    .comment-link-btn {
      background-color: #4299e1;
      color: white;
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 5px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
      text-align: center;
      min-height: 36px;
      box-sizing: border-box;
    }
    .comment-link-btn:hover {
      background-color: #3182ce;
    }
    .links-style-1 { justify-content: flex-end; }
    .links-style-2 { justify-content: center; }
    .links-style-3 { justify-content: flex-start; }
    .links-style-4 { flex-direction: column; align-items: stretch; }
    .links-style-4 .comment-link-btn { width: 100%; }
    .links-style-5 { 
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .links-style-5 .comment-link-btn { width: 100%; }
    .links-style-6 { 
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .links-style-6 .comment-link-btn { width: 100%; }
    .links-style-7 { 
      display: flex;
      flex-wrap: nowrap;
      justify-content: space-between;
    }
    .links-style-7 .comment-link-btn { 
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .links-style-8 .comment-link-btn {
      background: none;
      color: #63b3ed;
      padding: 0;
      text-decoration: underline;
    }
    .links-style-8 .comment-link-btn:hover {
      background: none;
      color: #4299e1;
    }
    .comment-media audio,
    .comment-media video {
      width: 100%;
      margin-top: 5px;
    }
  `;
  document.head.appendChild(style);

  function extractMediaAndLinks(text) {
    if (!text) return { text: text, media: [], links: [] };
    
    const media = [];
    const links = [];
    
    const mediaRegex = /\[(https?:\/\/[^\]]+\.(png|jpg|jpeg|gif|mp4|m4a|ogg|mp3|wav))\]/gi;
    let processedText = text.replace(mediaRegex, (match, url, ext) => {
      const type = ext.match(/(mp4|m4a)/) ? 'video' : 
                  ext.match(/(ogg|mp3|wav)/) ? 'audio' : 'image';
      media.push({ 
        url: url, 
        type: type, 
        style: 1 
      });
      return '';
    });
    
    const mediaWithStyleRegex = /\[(https?:\/\/[^\]]+\.(png|jpg|jpeg|gif))\s*,\s*(\d)\]/gi;
    processedText = processedText.replace(mediaWithStyleRegex, (match, url, ext, styleNum) => {
      media.push({ 
        url: url, 
        type: 'image', 
        style: parseInt(styleNum) || 1 
      });
      return '';
    });
    
    const buttonRegex = /\['([^']+)':\s*'([^']+)'\s*,\s*(\d)\]/gi;
    processedText = processedText.replace(buttonRegex, (match, btnText, btnUrl, styleNum) => {
      links.push({ 
        text: btnText.trim(), 
        url: btnUrl.trim(), 
        style: parseInt(styleNum) || 6 
      });
      return '';
    });
    
    const buttonDefaultRegex = /\['([^']+)':\s*'([^']+)'\s*\]/gi;
    processedText = processedText.replace(buttonDefaultRegex, (match, btnText, btnUrl) => {
      links.push({ 
        text: btnText.trim(), 
        url: btnUrl.trim(), 
        style: 6 
      });
      return '';
    });
    
    processedText = processedText.trim()
      .replace(/\s+/g, ' ')
      .replace(/\[\s*\]|''|\[\s*,\s*\d\]/g, '');
    
    return { text: processedText, media: media, links: links };
  }

  function createMediaElement(media) {
    if (media.type === 'image') {
      const img = document.createElement('img');
      img.src = media.url;
      img.className = `comment-media-item media-style-${media.style}`;
      img.alt = 'صورة مرفقة';
      img.loading = 'lazy';
      img.onerror = function() {
        this.style.display = 'none';
      };
      return img;
    } else if (media.type === 'video') {
      const video = document.createElement('video');
      video.src = media.url;
      video.className = 'comment-media-item media-style-1';
      video.controls = true;
      return video;
    } else if (media.type === 'audio') {
      const audio = document.createElement('audio');
      audio.src = media.url;
      audio.className = 'comment-media-item';
      audio.controls = true;
      return audio;
    }
  }

  function processCommentElement(commentElement) {
    const textElement = commentElement.querySelector('.comment-text');
    if (!textElement) return;
    
    const originalText = textElement.textContent || textElement.innerText;
    const processed = extractMediaAndLinks(originalText);
    
    textElement.textContent = processed.text;
    
    let contentElement = commentElement.querySelector('.comment-content');
    if (!contentElement) {
      contentElement = document.createElement('div');
      contentElement.className = 'comment-content';
      textElement.parentNode.insertBefore(contentElement, textElement);
      contentElement.appendChild(textElement);
    }
    
    const existingMedia = contentElement.querySelector('.comment-media');
    if (existingMedia) {
      existingMedia.remove();
    }
    
    if (processed.media.length > 0) {
      const mediaContainer = document.createElement('div');
      mediaContainer.className = 'comment-media';
      
      processed.media.forEach(media => {
        const mediaElement = createMediaElement(media);
        if (mediaElement) {
          mediaContainer.appendChild(mediaElement);
        }
      });
      
      contentElement.appendChild(mediaContainer);
    }
    
    const existingLinks = contentElement.querySelector('.comment-links');
    if (existingLinks) {
      existingLinks.remove();
    }
    
    if (processed.links.length > 0) {
      const linksContainer = document.createElement('div');
      linksContainer.className = `comment-links links-style-${processed.links[0].style}`;
      
      processed.links.forEach(link => {
        const linkElement = document.createElement('a');
        linkElement.href = link.url;
        linkElement.className = 'comment-link-btn';
        linkElement.textContent = link.text;
        linksContainer.appendChild(linkElement);
      });
      
      contentElement.appendChild(linksContainer);
    }
  }

  function processAllComments() {
    const comments = document.querySelectorAll('.comment-card, .reply-card');
    comments.forEach(comment => {
      processCommentElement(comment);
    });
  }

  const observer = new MutationObserver(function(mutations) {
    let shouldProcess = false;
    
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length) {
        mutation.addedNodes.forEach(function(node) {
          if (node.nodeType === 1) {
            if (node.classList && (node.classList.contains('comment-card') || node.classList.contains('reply-card'))) {
              shouldProcess = true;
            } else if (node.querySelectorAll('.comment-card, .reply-card').length > 0) {
              shouldProcess = true;
            }
          }
        });
      }
    });
    
    if (shouldProcess) {
      setTimeout(processAllComments, 50);
    }
  });

  setTimeout(() => {
    processAllComments();
    observer.observe(document.body, { childList: true, subtree: true });
  }, 500);
});

(function() {
  const originalShowAddCommentModal = window.showAddCommentModal;
  const originalShowEditCommentModal = window.showEditCommentModal;
  const originalShowReplyModal = window.showReplyModal;
  
  function countTextWithoutMedia(text) {
    if (!text) return 0;
    
    let cleanText = text.replace(/\[(https?:\/\/[^\]]+\.(png|jpg|jpeg|gif|mp4|m4a|ogg|mp3|wav))\]/gi, '');
    cleanText = cleanText.replace(/\[(https?:\/\/[^\]]+\.(png|jpg|jpeg|gif))\s*,\s*\d\]/gi, '');
    cleanText = cleanText.replace(/\['([^']+)':\s*'([^']+)'\s*,\s*\d\]/gi, '');
    cleanText = cleanText.replace(/\['([^']+)':\s*'([^']+)'\s*\]/gi, '');
    
    return cleanText.length;
  }
  
  function setupTextCounter(textarea, counter) {
    if (!textarea || !counter) return;
    
    const updateCounter = () => {
      const length = countTextWithoutMedia(textarea.value);
      counter.textContent = length;
      
      if (length > 200) {
        const cleanValue = textarea.value.substring(0, 200 + (textarea.value.length - length));
        textarea.value = cleanValue;
        counter.textContent = 200;
      }
    };
    
    updateCounter();
    
    textarea.addEventListener('input', updateCounter);
  }
  
  if (originalShowAddCommentModal) {
    window.showAddCommentModal = function() {
      originalShowAddCommentModal();
      
      setTimeout(() => {
        const textarea = document.getElementById('comment-text');
        const counter = document.getElementById('text-counter');
        setupTextCounter(textarea, counter);
      }, 100);
    };
  }
  
  if (originalShowEditCommentModal) {
    window.showEditCommentModal = function(comment) {
      originalShowEditCommentModal(comment);
      
      setTimeout(() => {
        const textarea = document.getElementById('edit-text');
        const counter = document.getElementById('edit-text-counter');
        setupTextCounter(textarea, counter);
      }, 100);
    };
  }
  
  if (originalShowReplyModal) {
    window.showReplyModal = function() {
      originalShowReplyModal();
      
      setTimeout(() => {
        const textarea = document.getElementById('reply-text');
        const counter = document.getElementById('reply-text-counter');
        setupTextCounter(textarea, counter);
      }, 100);
    };
  }
  
  const originalSubmitComment = window.submitComment;
  if (originalSubmitComment) {
    window.submitComment = function() {
      const textarea = document.getElementById('comment-text') || document.getElementById('edit-text');
      if (textarea) {
        const length = countTextWithoutMedia(textarea.value);
        if (length > 200) {
          alert('النص يتجاوز الحد المسموح به (200 حرف)');
          return;
        }
      }
      originalSubmitComment();
    };
  }
})();
</script>
<script>
(function() {
  const containerSelector = '.average-rating';
  const displayEl = document.getElementById('ratings');
  if (!displayEl) return; 

  let lastText = null;
  function readAndUpdate(container) {
    if (!container) return false;

    const valueSpan = container.querySelector('.average-rating-value');
  
    const spans = Array.from(container.querySelectorAll('span'));
    const countSpan = spans.find(s => !s.classList.contains('average-rating-value')) || null;

    const rawValue = valueSpan ? valueSpan.textContent.trim() : '';
    const rawCount = countSpan ? countSpan.textContent.trim() : '';
    const valueMatch = rawValue.match(/[\d.,]+/);
    let value = valueMatch ? valueMatch[0].replace(',', '.') : (rawValue || '0.0');

    let count = '';
    const countMatch = rawCount.match(/[\d,]+/);
    if (countMatch) {
      count = countMatch[0].replace(',', '');
    }

    const displayText = count ? `[ التقييم: ${value} (${count}) ]` : `[ التقييم: ${value} ]`;

    if (displayText !== lastText) {
      displayEl.textContent = displayText;
      lastText = displayText;
    }
    return true;
  }
  
  let mo = null;
  function observeContainer(container) {
    if (!container) return;
    if (mo) mo.disconnect();
    mo = new MutationObserver(() => readAndUpdate(container));
    mo.observe(container, {
      childList: true,
      subtree: true,
      characterData: true,
      attributes: true,
      attributeFilter: ['class', 'data-value']
    });
  }

  let pollingInterval = null;
  function startPolling() {
    if (pollingInterval) return;
    pollingInterval = setInterval(() => {
      const container = document.querySelector(containerSelector);
      if (container) {
        clearInterval(pollingInterval);
        pollingInterval = null;
        readAndUpdate(container);
        observeContainer(container);
      }
    }, 300);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector(containerSelector);
    if (container) {
      readAndUpdate(container);
      observeContainer(container);
    } else {
      startPolling();
    }
  });
  
  window.updateRatingsFromAverage = function() {
    const c = document.querySelector(containerSelector);
    if (c) readAndUpdate(c);
  };
})();
</script>

</body>
</html>
